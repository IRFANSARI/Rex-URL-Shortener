<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Links - Rex URL Shortener</title>
  </head>

  <style>
    /* General styles */
    * {
      margin: 0;
      padding: 0;
      font-family: 'Courier New', monospace;
      box-sizing: border-box;
    }

    body {
      background-color: #121212;
      color: #e0e0e0;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background-color: #1e1e1e;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .logo {
      font-size: 2rem;
      font-weight: bold;
      color: #007bff;
    }

    .button-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 1rem;
      color: #ffffff;
      background-color: #007bff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }

    button:hover {
      background-color: #0056b3;
    }

    /* Styles for the toggle switch */
    /* .theme-checkbox {
  --toggle-size: 10px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 4em;
  height: 2em;
  background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
  background-size: 205%;
  background-position: 0;
  transition: 0.4s;
  border-radius: 99em;
  position: relative;
  cursor: pointer;
  font-size: var(--toggle-size);
  vertical-align: middle;
}

.theme-checkbox::before {
  content: '';
  width: 1.4em;
  height: 1.4em;
  position: absolute;
  top: 0.3em;
  left: 0.3em;
  background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
  background-size: 205%;
  background-position: 100%;
  border-radius: 50%;
  transition: 0.4s;
}

.theme-checkbox:checked::before {
  left: calc(100% - 1.4em - 0.3em);
  background-position: 0;
}

.theme-checkbox:checked {
  background-position: 100%;
}

body.light-mode {
  background-color: #f0f0f0;
  color: #333333;
}

.header.light-mode {
  background-color: #ffffff;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

button.light-mode {
  background-color: #007bff;
} */

    /* Theme Toggle Container */
    .theme-toggle-container {
      display: flex;
      align-items: center;
    }

    .theme-icon {
      font-size: 1.5rem;
      vertical-align: middle;
    }

    .theme-icon.sun {
      margin-right: 15px;
    }

    .theme-checkbox {
      --toggle-size: 10px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 4em;
      height: 2em;
      background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
      background-size: 205%;
      background-position: 0;
      transition: 0.4s;
      border-radius: 99em;
      position: relative;
      cursor: pointer;
      font-size: var(--toggle-size);
      vertical-align: middle;
    }

    .theme-checkbox::before {
      content: '';
      width: 1.4em;
      height: 1.4em;
      position: absolute;
      top: 0.3em;
      left: 0.3em;
      background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
      background-size: 205%;
      background-position: 100%;
      border-radius: 50%;
      transition: 0.4s;
    }

    .theme-checkbox:checked::before {
      left: calc(100% - 1.4em - 0.3em);
      background-position: 0;
    }

    .theme-checkbox:checked {
      background-position: 100%;
    }

    /* Theme-based icon color */
    body.light-mode .theme-icon.moon {
      color: #000000; /* Dim moon icon in light mode */
      font-size: 20px;
    }

    body.light-mode .theme-icon.sun {
      color: #f39c12; /* Bright sun icon in light mode */
    }

    body:not(.light-mode) .theme-icon.moon {
      color: #f39c12; /* Bright moon icon in dark mode */
      font-size: 20px;
    }

    body:not(.light-mode) .theme-icon.sun {
      color: rgb(255, 255, 255); /* Dim sun icon in dark mode */
    }

    /* Existing styles */
    body.light-mode {
      background-color: #f0f0f0;
      color: #333333;
    }

    .header.light-mode {
      background-color: #ffffff;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    button.light-mode {
      background-color: #007bff;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #1e1e1e;
      color: #e0e0e0;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      position: relative; /* For positioning close button */
    }

    .modal-content h2 {
      margin-top: 0;
    }

    /* Close Button */
    .close {
      color: #aaa;
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: #fff;
    }

    /* Form Styles */
    .modal-content .form-group {
      margin-bottom: 15px;
    }

    .modal-content .form-group label {
      display: block;
      font-weight: bold;
    }

    .modal-content .form-group .input-field {
      width: 100%;
      padding: 10px;
      border: 1px solid #333;
      border-radius: 5px;
      background-color: #333;
      color: #fff;
    }

    .modal-content .error-message {
      color: red;
      margin-bottom: 10px;
    }

    .modal-content button {
      padding: 10px 20px;
      font-size: 1rem;
      color: #ffffff;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }

    .modal-content button:hover {
      background-color: #0056b3;
    }

    /* Light Mode Styles for Modal */
    body.light-mode .modal-content {
      background-color: #ffffff;
      color: #333333;
    }

    body.light-mode .modal-content .form-group input {
      border: 1px solid #ccc;
      background-color: #fff;
      color: #333;
    }

    body.light-mode .modal-content button {
      background-color: #007bff;
    }

    body.light-mode .modal-content button:hover {
      background-color: #0056b3;
    }

    /* Add these styles */
    .modal-content .form-group button {
      margin-top: 10px;
      padding: 8px 15px;
      font-size: 0.9rem;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      color: #ffffff;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }

    .modal-content .form-group button:hover {
      background-color: #0056b3;
    }

    /* Styles for the password toggle checkbox */ /* Styles for the password toggle checkbox */ /* Styles for the password toggle checkbox */
    /* Styles for the password toggle checkbox */
    .password-toggle {
      display: flex;
      align-items: center;
      margin-top: 10px;
      justify-content: flex-start;
    }

    .password-checkbox {
      margin-right: 5px;
      width: 15px;
      height: 15px;
    }

    /* Dark mode styles */
    .password-toggle label {
      font-size: 0.9rem;
      color: #e0e0e0; /* Default text color for dark mode */
      cursor: pointer;
    }

    /* Light mode styles */
    body.light-mode .password-toggle label {
      color: #333; /* Text color for light mode */
    }

    #logo-link {
      text-decoration: none;
    }

    /* Add these styles to home.css */
    /* Profile Picture Styles */ /* Profile Picture Styles */
    .profile-container {
      position: relative;
      display: inline-block;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #007bff; /* Default color */
      color: #fff; /* Icon color */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      border: 2px solid #e0e0e0; /* Light border for dark mode */
      text-align: center;
    }

    body.light-mode .profile-pic {
      border: 2px solid #333; /* Dark border for light mode */
    }

    /* Dropdown Styles */
    .profile-dropdown {
      display: none;
      position: absolute;
      top: 50px;
      right: 0;
      background-color: #1e1e1e;
      color: #e0e0e0;
      min-width: 150px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
      z-index: 1;
    }

    body.light-mode .profile-dropdown {
      background-color: #ffffff;
      color: #333333;
    }

    .dropdown-item {
      padding: 12px 16px;
      text-align: left;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }

    body.light-mode .dropdown-item {
      border-bottom: 1px solid #ccc;
    }

    .dropdown-item:hover {
      background-color: #333;
    }

    body.light-mode .dropdown-item:hover {
      background-color: #f0f0f0;
    }

    #user-name {
      cursor: default;
      font-weight: bold;
    }

    #sign-out:hover {
      background-color: #ff3b3b;
      color: #ffffff;
    }

    body.light-mode #sign-out:hover {
      background-color: #ff3b3b;
      color: #ffffff;
    }

    /* Container styles */
    /* Default Dark Mode Variables */
    /* Default Dark Mode Variables */
    :root {
      --container-bg-color: #1e1e1e;
      --table-header-bg-color: #444;
      --table-header-color: #f9f9f9;
      --table-border-color: #555; /* Outer table border */
      --column-border-color: #666; /* Lighter inner column border */
    }

    /* Light Mode Variables */
    .light-mode {
      --container-bg-color: #f9f9f9;
      --table-header-bg-color: #f0f0f0;
      --table-header-color: #333;
      --table-border-color: #ccc; /* Outer table border */
      --column-border-color: #ddd; /* Lighter inner column border */
    }

    /* Container styles */
    .container {
      padding: 20px;
      margin: 20px auto;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: var(--container-bg-color);
      transition: background-color 0.3s ease;
    }

    /* Table styles */
    table {
      width: 100%;
      border-collapse: collapse;
      border: 2px solid var(--table-border-color); /* Outer table border */
    }

    th,
    td {
      /* padding: 12px; */
      text-align: center; /* Center content */
      border-right: 1px solid var(--column-border-color); /* Lighter inner column border */
    }

    th:last-child,
    td:last-child {
      border-right: none; /* Remove the last column border */
    }

    th {
      background-color: var(--table-header-bg-color);
      color: var(--table-header-color);
    }

    /* Specific column widths */
    /* th:nth-child(1),
td:nth-child(1) {
  width: 10%;
} */

    th:nth-child(3),
    td:nth-child(3) {
      /* Delete */
      width: 10%;
    }

    /* Container for the URL input and copy button */
    .url-container {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }

    /* Style for the URL input */
    .url-input {
      width: calc(
        100% - 60px
      ); /* Adjust width to make space for the copy button */
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px 0 0 4px;
      font-size: 1em;
      margin-right: -1px;
      font-weight: bold;
      color: #333;
      background-color: #f0f0f0;
      box-sizing: border-box;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Placeholder style */
    .url-input::placeholder {
      color: #aaa;
      font-weight: bold;
    }

    /* Style for the copy button */
    .copy-btn {
      padding: 10px;
      background-color: #28a745; /* Default background color */
      color: #fff;
      border: 1px solid #28a745; /* Default border color */
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    /* Hover state for the copy button */
    .copy-btn:hover {
      background-color: #218838; /* Darker green on hover */
    }

    /* Delete button styles */
    .delete-button {
      color: #fff;
      background-color: #e57373;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
    }

    .delete-button:hover {
      background-color: #c62828;
    }

    /* Light Theme Styles */
    body.light-mode .url-input {
      background-color: #fff;
      color: #212121;
      border: 1px solid #ddd;
    }

    body.light-mode .copy-btn {
      background-color: #f0f0f0;
      color: #212121;
      border: 1px solid #ccc;
    }

    body.light-mode .copy-btn:hover {
      background-color: #e0e0e0;
    }

    body.light-mode .delete-button {
      color: #212121;
      background-color: #ff8a80;
    }

    body.light-mode .delete-button:hover {
      background-color: #ff5252;
    }

    /* Border between Header and Data Rows */
    th {
      border-bottom: 2px solid #444; /* Darker border for header */
      padding: 15px;
    }

    /* Border between Individual Cells */
    td {
      border-top: 1px solid #ddd; /* Lighter border for cell separation */
    }

    /* Optional: Border around the entire table */
    table {
      border: 1px solid #ddd; /* Light border around the table */
      /* border-radius: 10px; */
    }

    .url-input {
      margin-left: 2%;
    }
  </style>

  <body>
    <div class="header">
      <a href="/" id="logo-link"><div class="logo">Rex URL Shortener</div></a>
      <div class="button-container">
        <span class="theme-icon moon">🌙</span>
        <input type="checkbox" id="theme-toggle" class="theme-checkbox" />
        <span class="theme-icon sun">☀️</span>

        <div class="profile-container">
          <div id="profile-pic" class="profile-pic">👤</div>
          <div id="profile-dropdown" class="profile-dropdown">
            <div class="dropdown-item" id="user-name"><%= username %></div>
            <div class="dropdown-item" id="sign-out">Sign Out</div>
          </div>
        </div>

        <div id="login-modal" class="modal">
          <div class="modal-content">
            <span class="close" id="login-close">&times;</span>
            <h2>Login</h2>
            <form id="login-form">
              <div class="form-group">
                <label for="login-username">Username</label>
                <input
                  type="text"
                  id="login-username"
                  name="username"
                  class="input-field"
                  required
                />
              </div>
              <div class="form-group">
                <label for="login-password">Password</label>
                <input
                  type="password"
                  id="login-password"
                  name="password"
                  class="input-field"
                  required
                />
                <div class="password-toggle">
                  <input
                    type="checkbox"
                    id="toggle-login-password"
                    class="password-checkbox"
                  />
                  <label for="toggle-login-password">Show Password</label>
                </div>
              </div>
              <div id="login-error" class="error-message"></div>
              <button type="submit">Login</button>
            </form>
          </div>
        </div>

        <div id="signup-modal" class="modal">
          <div class="modal-content">
            <span class="close" id="signup-close">&times;</span>
            <h2>Sign Up</h2>
            <form id="signup-form">
              <div class="form-group">
                <label for="signup-username">Username</label>
                <input
                  type="text"
                  id="signup-username"
                  name="username"
                  class="input-field"
                  required
                />
              </div>
              <div class="form-group">
                <label for="signup-password">Password</label>
                <input
                  type="password"
                  id="signup-password"
                  name="password"
                  class="input-field"
                  required
                />
                <div class="password-toggle">
                  <input
                    type="checkbox"
                    id="toggle-signup-password"
                    class="password-checkbox"
                  />
                  <label id="show-pass-label" for="toggle-signup-password"
                    >Show Password</label
                  >
                </div>
              </div>
              <div id="signup-error" class="error-message"></div>
              <button type="submit">Register</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <table class="url-table">
        <thead>
          <tr>
            <!-- <th>Serial No.</th> -->
            <th>Short URL</th>
            <th>Long URL</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          <td class="url-cell">
            <% let serialNo = 0; data.forEach(row => { serialNo++; %>
            <tr>
              <!-- <td><%= serialNo %></td> -->
              <td class="url-cell">
                <div class="url-container">
                  <input
                    type="text"
                    class="url-input"
                    value="<%= row.short_url %>"
                    readonly
                  />
                  <button class="copy-btn">📋</button>
                </div>
              </td>
              <td class="url-cell">
                <div class="url-container">
                  <input
                    type="text"
                    class="url-input"
                    value="<%= row.long_url %>"
                    readonly
                  />
                  <button class="copy-btn">📋</button>
                </div>
              </td>
              <td>
                <button
                  class="delete-button"
                  data-short-url="<%= row.short_url %>"
                >
                  Delete
                </button>
              </td>
            </tr>
            <% }); %>
          </td>
        </tbody>
      </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        const $body = $('body');
        const $header = $('.header');
        const $buttons = $('button');
        const $themeToggle = $('#theme-toggle');

        // Check for saved theme in localStorage
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'light') {
          $body.addClass('light-mode');
          $header.addClass('light-mode');
          $buttons.addClass('light-mode');
          $('.container').addClass('light-mode');

          $themeToggle.prop('checked', true);
        } else {
          // Default to dark mode
          localStorage.setItem('theme', 'dark');
          $themeToggle.prop('checked', false);
        }

        $themeToggle.on('change', function () {
          const isLightMode = $themeToggle.is(':checked');
          $body.toggleClass('light-mode', isLightMode);
          $header.toggleClass('light-mode', isLightMode);
          $buttons.toggleClass('light-mode', isLightMode);
          $('.container').toggleClass('light-mode', isLightMode);

          // Save theme preference
          localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
        });

        $('#profile-icon').click(function () {
          $('#logout-menu').toggle();
        });

        const $profilePic = $('#profile-pic');
        const $profileDropdown = $('#profile-dropdown');

        // Toggle the dropdown when profile picture is clicked
        $profilePic.on('click', function () {
          $profileDropdown.toggle();
        });

        // Hide dropdown when clicking outside of it
        $(window).on('click', function (event) {
          if (!$(event.target).closest('.profile-container').length) {
            $profileDropdown.hide();
          }
        });

        // Sign out functionality
        $('#sign-out').on('click', function () {
          // Redirect to logout route
          window.location.href = '/user/signout';
        });

        $('.copy-btn').on('click', function () {
          // Find the closest input field in the same URL container
          var inputField = $(this).siblings('.url-input');
          var textToCopy = inputField.val();

          // Create a temporary textarea element to copy the text
          var tempInput = $('<textarea>');
          $('body').append(tempInput);
          tempInput.val(textToCopy).select();

          // Copy the text to the clipboard
          document.execCommand('copy');

          // Remove the temporary textarea
          tempInput.remove();

          // Change the button text to indicate success
          var originalText = $(this).text();
          $(this).text('✔️').addClass('copied');

          // Revert back to the original button text after 1 second
          setTimeout(() => {
            $(this).text(originalText).removeClass('copied');
          }, 500);
        });

        $('.delete-button').on('click', function () {
          var shortURL = $(this).data('short-url');
          var $row = $(this).closest('tr'); // Get the row element for this button

          $.ajax({
            url: '/links',
            method: 'DELETE',
            data: { shortURL: shortURL },
            success: function (response) {
              if (response.success) {
                $row.remove();
              } else {
                alert('Failed to delete link.');
              }
            },
            error: function () {
              alert('Error occurred while deleting link.');
            },
          });
        });
      });
    </script>
  </body>
</html>
