<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rex URL Shortener</title>
    <link rel="stylesheet" href="./css/index.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="header">
      <a href="." id="logo-link"><div class="logo">Rex URL Shortener</div></a>
      <div class="button-container">
        <!-- Toggle switch for dark/light mode -->
        <input type="checkbox" id="theme-toggle" class="theme-checkbox" />
        <button onclick="window.location.href='#';">Login</button>
        <button onclick="window.location.href='#';">Sign Up</button>

        <!-- Login Modal -->
        <div id="login-modal" class="modal">
          <div class="modal-content">
            <span class="close" id="login-close">&times;</span>
            <h2>Login</h2>
            <form id="login-form">
              <div class="form-group">
                <label for="login-username">Username</label>
                <input
                  type="text"
                  id="login-username"
                  name="username"
                  class="input-field"
                  required
                />
              </div>
              <div class="form-group">
                <label for="login-password">Password</label>
                <input
                  type="password"
                  id="login-password"
                  name="password"
                  class="input-field"
                  required
                />
                <div class="password-toggle">
                  <input
                    type="checkbox"
                    id="toggle-login-password"
                    class="password-checkbox"
                  />
                  <label for="toggle-login-password">Show Password</label>
                </div>
              </div>
              <div id="login-error" class="error-message"></div>
              <button type="submit">Login</button>
            </form>
          </div>
        </div>

        <!-- Signup Modal -->
        <div id="signup-modal" class="modal">
          <div class="modal-content">
            <span class="close" id="signup-close">&times;</span>
            <h2>Sign Up</h2>
            <form id="signup-form">
              <div class="form-group">
                <label for="signup-username">Username</label>
                <input
                  type="text"
                  id="signup-username"
                  name="username"
                  class="input-field"
                  required
                />
              </div>
              <div class="form-group">
                <label for="signup-password">Password</label>
                <input
                  type="password"
                  id="signup-password"
                  name="password"
                  class="input-field"
                  required
                />
                <div class="password-toggle">
                  <input
                    type="checkbox"
                    id="toggle-signup-password"
                    class="password-checkbox"
                  />
                  <label id="show-pass-label" for="toggle-signup-password"
                    >Show Password</label
                  >
                </div>
              </div>
              <div id="signup-error" class="error-message"></div>
              <button type="submit">Register</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        const $body = $('body');
        const $header = $('.header');
        const $buttons = $('button');
        const $themeToggle = $('#theme-toggle');

        // Check for saved theme in localStorage
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'light') {
          $body.addClass('light-mode');
          $header.addClass('light-mode');
          $buttons.addClass('light-mode');
          $themeToggle.prop('checked', true);
        } else {
          // Default to dark mode
          localStorage.setItem('theme', 'dark');
          $themeToggle.prop('checked', false);
        }

        $themeToggle.on('change', function () {
          const isLightMode = $themeToggle.is(':checked');
          $body.toggleClass('light-mode', isLightMode);
          $header.toggleClass('light-mode', isLightMode);
          $buttons.toggleClass('light-mode', isLightMode);

          // Save theme preference
          localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
        });

        // Modal functionality
        const $loginModal = $('#login-modal');
        const $signupModal = $('#signup-modal');
        const $loginClose = $('#login-close');
        const $signupClose = $('#signup-close');

        $('button').click(function () {
          if ($(this).text() === 'Login') {
            $loginModal.show();
          } else if ($(this).text() === 'Sign Up') {
            $signupModal.show();
          }
        });

        const clearFormData = () => {
          $('#signup-username').val('');
          $('#signup-password').val('');
          $('#login-username').val('');
          $('#login-password').val('');
          $('#login-error').text('');
          $('#signup-error').text('');
        };

        $loginClose.click(function () {
          clearFormData();
          $loginModal.hide();
        });

        $signupClose.click(function () {
          clearFormData();
          $signupModal.hide();
        });

        $(window).click(function (event) {
          if ($(event.target).is('.modal')) {
            clearFormData();
            $loginModal.hide();
            $signupModal.hide();
          }
        });

        // Handle form submissions (dummy error handling for demonstration)
        $('#login-form').submit(function (event) {
          event.preventDefault();

          const username = $('#login-username').val();
          const password = $('#login-password').val();

          $.ajax({
            url: '/login',
            type: 'POST',
            data: { username, password },
            success: function (response) {
              if (response.redirect) {
                window.location.href = response.redirect;
              } else {
                $('#login-error').text(response.message);
              }
            },
          });
        });

        $('#signup-form').submit(function (event) {
          event.preventDefault();

          const username = $('#signup-username').val();
          const password = $('#signup-password').val();

          $.ajax({
            url: '/signup',
            type: 'POST',
            data: { username, password },
            success: function (response) {
              if (response.redirect) {
                window.location.href = response.redirect;
              } else {
                $('#signup-error').text(response.message);
              }
            },
          });
        });

        // Toggle password visibility
        $('#toggle-login-password').change(function () {
          const $passwordField = $('#login-password');
          const type = $(this).is(':checked') ? 'text' : 'password';
          $passwordField.attr('type', type);
        });

        $('#toggle-signup-password').change(function () {
          const $passwordField = $('#signup-password');
          const type = $(this).is(':checked') ? 'text' : 'password';
          $passwordField.attr('type', type);
        });
      });
    </script>
  </body>
</html>
